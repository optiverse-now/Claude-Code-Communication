# Claude Code TDD駆動開発

このプロジェクトはClaude Codeを使用した厳格なTDD（テスト駆動開発）ワークフローを実装します。

## 開発ガイドライン

- 英語で思考し、日本語で回答を生成
- すべてのコードコメントは日本語
- TDD原則を厳格に守る: Red → Green → Refactor
- エラーで詰まった時は Context7 MCPを使って公式ドキュメントを参照して問題を解決する

## TDD駆動開発ワークフロー

### ワークフロー概要

TDDは厳格な**3フェーズワークフロー**に従います：

```
フェーズ1: Red（テスト作成） → フェーズ2: Green（実装） → フェーズ3: Refactor（改善）
```

**重要原則**: 各フェーズは次に進む前に完了する必要があります。失敗テストでの実装や実装なしでのリファクタリングは禁止されています。

### 実行トリガー条件

以下の場合にTDDワークフローを自動開始：

- 「〜を実装」や「〜機能を追加」などの実装タスク
- 「テストを書く」や「〜のTDD」などの明示的な指示
- 複数の機能要件を含むタスク

### フェーズ1: Red（テスト作成）

1. **結合テスト作成**: `__tests__/integration/[機能名].integration.test.ts`を作成
2. **結合テスト実行**: `npm test -- --testNamePattern="[結合テスト名]"`（失敗する必要があります）
3. **単体テスト作成**: `__tests__/unit/[機能名].test.ts`を作成
4. **単体テスト実行**: `npm test -- --testNamePattern="[単体テスト名]"`（失敗する必要があります）

### フェーズ2: Green（実装）

1. **最小実装**: `src/[機能名].ts`を作成/編集（テストを通すための最小コード）
2. **単体テスト実行**: `npm test -- --testNamePattern="[単体テスト名]"`
3. **結合テスト実行**: `npm test -- --testNamePattern="[結合テスト名]"`

### フェーズ3: Refactor（改善）

1. **コード改善**: 重複除去、可読性向上、性能最適化
2. **全テスト実行**: `npm test`

### 完了

1. **全テスト通過確認**: `npm test`
2. **全ESLint通過確認**: `npm run lint`
3. **ビルド通過確認**: `npm run build`

## 開発ルール

1. **TDDを厳格に守る**: 常にRed → Green → Refactorの順序に従う
2. **テストファースト**: 実装前に必ずテストを書く
3. **最小実装**: Greenフェーズでは実装を最小限に抑える
4. **順序強制**: 結合テスト（Red） → 単体テスト（Red） → 実装（Green） → リファクタリング
5. **完了基準**: 全テストが100%通過すること

## ESLint/ビルドエラー処理

### エラー処理ルール

1. **ESLint/ビルドエラーが発生した場合**:
   - **ESLintやPrettierの設定を変更しない**
   - **既存ルールに準拠するようにコードを修正**
   - **修正時にTDD原則を守る**

2. **エラー解決ワークフロー**:

   ```
   1. ビルド出力からエラー箇所を特定
   2. 影響するコードにテストが存在しない場合は作成
   3. 既存コードパターンに従ってエラーを修正
   4. 全テストがまだ通過することを確認
   ```

3. **一般的なESLintエラーと解決策**:
   - **型アサーション**: `as`の代わりに型ガードを使用
   - **Any型**: 適切な型を定義するか、型ガードでunknownを使用
   - **Awaitなしのasync**: Promiseを直接返すかvoid演算子を使用
   - **テストでの空関数**: 代わりに`jest.fn()`を使用

4. **重要な制約**:
   - **`.eslintrc`、`eslint.config.mjs`、`prettier.config.mjs`を変更しない**
   - **明示的なユーザー許可なしに`eslint-disable`コメントを追加しない**
   - **明示的なユーザー許可なしに`@ts-ignore`コメントを追加しない**
   - **エラーを回避するためにTypeScriptコンパイラオプションを変更しない**
   - **エラーを抑制せず、根本原因を修正する**

## テスト失敗処理

- 失敗テストを即座に修正
- 次のフェーズに進む前に全テストが通過することを確認
- テスト失敗を解決できない場合はユーザーガイダンスを要求
